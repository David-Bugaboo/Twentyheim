rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Permite que cada usuário leia/escreva apenas seus próprios documentos
    match /users/{userId} {
      // Documento do usuário
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Qualquer documento em QUALQUER subcoleção de users/{userId}
      match /{document=**} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // Coleção de warband-snapshots compartilhados
    // Permite que qualquer um leia (para links compartilhados)
    // Permite criar para usuários autenticados
    match /warband-snapshots/{snapshotId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false; // Snapshots são imutáveis
    }

    // Coleção admin-data
    // Leitura pública (os dados são públicos - vêm dos arquivos estáticos)
    // Escrita apenas para administradores
    match /admin-data/{documentId} {
      allow read: if true; // Qualquer um pode ler (dados são públicos)
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    // Coleções de dados base (base-equipment, base-figures, base-skills, etc.)
    // Leitura pública - dados estáticos que qualquer um deve poder acessar
    // Escrita apenas para administradores
    match /base-equipment/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-figures/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-skills/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-spells/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-mutations/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-sacred-marks/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /base-nurgle-blessings/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    // Coleções de warbands (dados de figuras por facção)
    // Leitura pública - dados estáticos que qualquer um deve poder acessar
    // Escrita apenas para administradores
    match /sisters-of-sigmar/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /skaven/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /beastman-raiders/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /dwarf-treasure-hunters/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /cult-of-the-possessed/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /vampire-courts/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /witch-hunters/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /lizardmen/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /orc-mob/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /goblins/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /sons-of-hashut/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /mercenaries/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /carnival-of-chaos/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /dark-elf-corsairs/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /wood-elves-of-athel-loren/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    // Coleções de equipamentos (mesmas regras das outras)
    match /armas-corpo-a-corpo/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /armas-a-distancia/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /armas-de-fogo/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /armaduras-e-escudos/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /acessorios/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /remedios-e-venenos/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /modificadores-de-arma/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /modificadores-de-arma-a-distancia/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    match /modificadores-de-armas-de-fogo/{documentId} {
      allow read: if true;
      allow write: if request.auth != null && (
        request.auth.token.email == "david.faco@gmail.com" ||
        request.auth.token.email == "davidfaco@gmail.com" ||
        request.auth.token.email == "davidfaco.ufc@gmail.com" ||
        (request.auth.token.email != null && 
         request.auth.token.email.matches("(?i).*david.*faco.*"))
      );
    }

    // Bloqueia qualquer outro acesso por padrão
    match /{document=**} {
      allow read, write: if false;
    }
  }
}